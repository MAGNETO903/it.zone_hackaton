/* --- START OF FILE App.css --- */
/* ... (Keep all previous styles: body, *, utils, app-container, sidebar, etc.) ... */
body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); overscroll-behavior: none; font-size: 16px; }
*, *::before, *::after { box-sizing: border-box; }
.visually-hidden { border: 0; clip: rect(0 0 0 0); height: 1px; margin: -1px; overflow: hidden; padding: 0; position: absolute; width: 1px; white-space: nowrap; }
.app-container { display: flex; height: 100vh; width: 100vw; max-width: 100%; margin: 0; overflow: hidden; }
.sidebar { width: 260px; flex-shrink: 0; background-color: var(--tg-theme-secondary-bg-color, #f0f0f0); border-right: 1px solid var(--tg-theme-hint-color, #dcdcdc); display: flex; flex-direction: column; height: 100%; transition: margin-left 0.3s ease-in-out, visibility 0.3s ease-in-out; position: relative; overflow-y: auto; z-index: 100; }
.app-container.sidebar-closed .sidebar { margin-left: -260px; visibility: hidden; }
.new-chat-button { display: flex; align-items: center; justify-content: center; gap: 8px; padding: 10px 15px; margin: 10px; border: 1px solid var(--tg-theme-button-color, #50a8eb); border-radius: 8px; background-color: transparent; color: var(--tg-theme-button-color, #50a8eb); cursor: pointer; font-size: 0.95em; font-weight: 500; transition: background-color 0.2s ease, color 0.2s ease, opacity 0.2s ease; flex-shrink: 0; }
.new-chat-button:hover:not(:disabled) { background-color: var(--tg-theme-button-color, #50a8eb); color: var(--tg-theme-button-text-color, #fff); }
.new-chat-button:disabled { opacity: 0.6; cursor: not-allowed; background-color: transparent !important; /* Override hover */ border-color: var(--tg-theme-hint-color, #ccc); color: var(--tg-theme-hint-color, #999); }
.new-chat-button svg { margin-bottom: -3px; }
.dialogue-list { flex-grow: 1; overflow-y: auto; padding: 0 10px 10px 10px; display: flex; flex-direction: column; gap: 4px; }
.dialogue-list-empty { text-align: center; padding: 20px; color: var(--tg-theme-hint-color, #888); font-size: 0.9em; }
.dialogue-item { display: flex; align-items: center; justify-content: space-between; padding: 8px 12px; border-radius: 6px; cursor: pointer; transition: background-color 0.15s ease, opacity 0.2s ease; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; position: relative; gap: 5px; }
.dialogue-item:hover { background-color: rgba(0, 0, 0, 0.05); }
.dialogue-item.active { background-color: var(--tg-theme-button-color, #50a8eb); color: var(--tg-theme-button-text-color, #fff); }
.dialogue-item.active:hover { background-color: #4095d6; }
.dialogue-title { flex-grow: 1; overflow: hidden; text-overflow: ellipsis; font-size: 0.9em; }
/* --- NEW: Style for disabled dialogue item (when editing) --- */
.dialogue-item.disabled {
    opacity: 0.7;
    cursor: not-allowed;
    background-color: transparent !important; /* Ensure no hover/active styles apply */
    color: var(--tg-theme-hint-color, #999) !important;
}
.dialogue-item.disabled.active { /* Still show active one slightly different */
    background-color: rgba(80, 168, 235, 0.3) !important; /* Dimmed active color */
    color: var(--tg-theme-text-color, #333) !important;
}
.dialogue-item.disabled .dialogue-actions button {
    color: var(--tg-theme-hint-color, #aaa) !important;
    cursor: not-allowed;
}
/* --- END NEW --- */
.dialogue-actions { display: flex; align-items: center; gap: 6px; flex-shrink: 0; opacity: 0; transition: opacity 0.15s ease-in-out; }
.dialogue-item:hover .dialogue-actions, .dialogue-item.active .dialogue-actions { opacity: 1; }
/* Hide actions on disabled items */
.dialogue-item.disabled .dialogue-actions { opacity: 0 !important; }

.action-button { background: none; border: none; padding: 3px; margin: 0; cursor: pointer; color: var(--tg-theme-hint-color, #999); transition: color 0.15s ease, opacity 0.15s ease; line-height: 1; display: flex; align-items: center; justify-content: center; min-width: 18px; min-height: 18px; }
.action-button:hover:not(:disabled) { /* Specific hover colors set below */ }
.action-button:disabled { cursor: not-allowed; opacity: 0.4 !important; color: var(--tg-theme-hint-color, #aaa); }
.dialogue-item.active .action-button { color: rgba(255, 255, 255, 0.8); }
.dialogue-item.active .action-button:hover:not(:disabled) { color: #fff; }
.export-button:hover:not(:disabled) { color: var(--tg-theme-link-color, #2481cc); }
.delete-dialogue-button:hover:not(:disabled) { color: var(--tg-theme-destructive-text-color, #e53935); }
.dialogue-item.active .export-button:hover:not(:disabled) { color: #fff; }
.dialogue-item.active .delete-dialogue-button:hover:not(:disabled) { color: #ffdddd; }
.loader-small { box-sizing: border-box; border: 2px solid rgba(128, 128, 128, 0.3); border-top: 2px solid currentColor; border-radius: 50%; width: 14px; height: 14px; animation: spin 0.8s linear infinite; }

.chat-main { flex-grow: 1; display: flex; flex-direction: column; height: 100%; overflow: hidden; position: relative; background-color: var(--tg-theme-bg-color, #fff); }
.overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0, 0, 0, 0.4); z-index: 99; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out; cursor: pointer; }
.app-container.sidebar-open .overlay { opacity: 1; visibility: visible; }
@media (min-width: 768px) { .overlay { display: none; } }
.sidebar-toggle-button { position: absolute; top: 8px; left: 8px; z-index: 101; background-color: rgba(255, 255, 255, 0.8); backdrop-filter: blur(2px); border: 1px solid var(--tg-theme-hint-color, #e0e0e0); border-radius: 50%; width: 36px; height: 36px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--tg-theme-text-color, #333); transition: background-color 0.2s ease, color 0.2s ease, box-shadow 0.2s ease, left 0.3s ease-in-out, opacity 0.2s ease; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
.sidebar-toggle-button:hover:not(:disabled) { background-color: var(--tg-theme-secondary-bg-color, #f5f5f5); box-shadow: 0 2px 5px rgba(0,0,0,0.15); }
.sidebar-toggle-button:disabled { opacity: 0.5; cursor: not-allowed; }
.sidebar-toggle-button svg { display: block; }
.chat-header { padding: 8px 15px 8px 55px; border-bottom: 1px solid var(--tg-theme-hint-color, #e0e0e0); display: flex; justify-content: space-between; align-items: center; flex-wrap: nowrap; gap: 15px; flex-shrink: 0; min-height: 53px; }
.chat-header h1 { margin: 0; font-size: 1.1em; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; }
.model-selector { display: flex; align-items: center; gap: 5px; flex-shrink: 0; }
.model-selector select { padding: 5px 10px; border: 1px solid var(--tg-theme-hint-color, #ccc); border-radius: 6px; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); font-size: 0.9em; cursor: pointer; max-width: 200px; transition: opacity 0.2s ease; }
.model-selector select:disabled { opacity: 0.7; cursor: not-allowed; }
.chat-messages { flex-grow: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
.chat-empty-state { text-align: center; margin-top: 40px; color: var(--tg-theme-hint-color, #888); font-size: 0.9em; }
.message { display: flex; max-width: 85%; word-wrap: break-word; position: relative; /* Needed for edit button positioning */ }
.message.user { align-self: flex-end; }
.message.assistant { align-self: flex-start; }
.message-content { padding: 9px 14px; border-radius: 18px; font-size: 0.95em; line-height: 1.5; position: relative; /* Edit button relative to this */ }
.message.user .message-content { background-color: var(--tg-theme-button-color, #50a8eb); color: var(--tg-theme-button-text-color, #fff); border-bottom-right-radius: 5px; }
.message.assistant .message-content { background-color: var(--tg-theme-secondary-bg-color, #f0f0f0); color: var(--tg-theme-text-color, #000); border-bottom-left-radius: 5px; }
.message-content p { margin: 0; }
.message.assistant .loading-indicator p { font-style: italic; color: var(--tg-theme-hint-color, #777); animation: blink 1.5s infinite; }
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
.message.error-message { width: auto; max-width: 90%; align-self: center; text-align: center; padding: 8px 15px; background-color: rgba(255, 0, 0, 0.1); border: 1px solid var(--tg-theme-destructive-text-color, red); border-radius: 8px; margin-top: 10px; }
.message.error-message p { color: var(--tg-theme-destructive-text-color, red); font-weight: 500; font-size: 0.9em; margin: 0; }
.chat-input-area { display: flex; align-items: flex-end; padding: 10px 15px; border-top: 1px solid var(--tg-theme-hint-color, #e0e0e0); gap: 10px; background-color: var(--tg-theme-bg-color, #fff); flex-shrink: 0; transition: opacity 0.2s ease; }
.chat-input-area textarea { flex-grow: 1; resize: none; border: 1px solid var(--tg-theme-hint-color, #ccc); border-radius: 18px; padding: 10px 15px; font-size: 1em; font-family: inherit; line-height: 1.4; max-height: 120px; overflow-y: auto; background-color: var(--tg-theme-bg-color, #fff); color: var(--tg-theme-text-color, #000); outline: none; transition: border-color 0.2s ease, opacity 0.2s ease, background-color 0.2s ease; }
.chat-input-area textarea:focus { border-color: var(--tg-theme-link-color, #2481cc); }
.chat-input-area textarea:disabled { opacity: 0.6; cursor: not-allowed; background-color: var(--tg-theme-secondary-bg-color, #f9f9f9); }
.chat-input-area button { padding: 0; width: 40px; height: 40px; border: none; background-color: var(--tg-theme-button-color, #50a8eb); color: var(--tg-theme-button-text-color, #fff); border-radius: 50%; cursor: pointer; transition: background-color 0.2s ease, opacity 0.2s ease; flex-shrink: 0; display: flex; align-items: center; justify-content: center; }
.chat-input-area button:hover:not(:disabled) { opacity: 0.9; }
.chat-input-area button:disabled { background-color: var(--tg-theme-hint-color, #ccc) !important; /* Ensure grey bg */ opacity: 0.7; cursor: not-allowed; }
.chat-input-area button svg { width: 18px; height: 18px; }
.chat-input-area button .loader-small { border-color: rgba(255, 255, 255, 0.4); border-top-color: #fff; }

/* --- NEW/MODIFIED: Message Editing Styles --- */
.edit-message-button {
    position: absolute;
    /* Place it outside the bubble, bottom-right */
    bottom: -8px;
    right: -8px;
    background-color: var(--tg-theme-bg-color, #fff); /* Page background */
    border: 1px solid var(--tg-theme-hint-color, #ddd);
    border-radius: 50%;
    width: 26px;
    height: 26px;
    padding: 0;
    margin: 0;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--tg-theme-hint-color, #777);
    opacity: 0; /* Hidden by default */
    visibility: hidden;
    transition: opacity 0.15s ease, visibility 0.15s ease, color 0.15s ease, border-color 0.15s ease;
    box-shadow: 0 1px 2px rgba(0,0,0,0.1);
    z-index: 1; /* Ensure it's above message content if overlapping */
}
.message.user:hover .edit-message-button {
    opacity: 1; /* Show on hover user message */
    visibility: visible;
}
.edit-message-button:hover {
    color: var(--tg-theme-text-color, #000);
    border-color: var(--tg-theme-text-color, #888);
}

/* Styles when a message IS being edited */
.message.editing {
    /* Optional: Add a visual indicator like a border or background change */
    /* border: 1px dashed var(--tg-theme-link-color, #2481cc); */
    /* padding: 2px; */
    /* margin: -3px; */
}
.message.editing .message-content {
    padding: 0; /* Remove bubble padding */
    background-color: transparent; /* Remove bubble background */
    box-shadow: none; /* Remove bubble shadow if any */
    border-radius: 0; /* Remove bubble radius */
    width: 100%; /* Make it take full width of the .message container */
}
.message.editing .message-content p,
.message.editing .message-content .edit-message-button {
    display: none; /* Hide original text and edit button */
}

.edit-area {
    display: flex;
    flex-direction: column;
    gap: 8px; /* Space between textarea and buttons */
    padding: 8px; /* Add some padding around the edit area */
    border: 1px solid var(--tg-theme-button-color, #50a8eb); /* Highlight editing area */
    border-radius: 8px;
    background-color: var(--tg-theme-bg-color, #fff); /* Ensure background */
}

.edit-area textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 8px 10px;
    border: 1px solid var(--tg-theme-hint-color, #ccc);
    border-radius: 6px;
    font-family: inherit;
    font-size: 0.95em; /* Match message font size */
    line-height: 1.5; /* Match message line height */
    background-color: var(--tg-theme-bg-color, #fff);
    color: var(--tg-theme-text-color, #000);
    resize: vertical;
    min-height: 60px; /* Minimum height */
    outline: none;
    transition: border-color 0.2s ease;
}
.edit-area textarea:focus {
    border-color: var(--tg-theme-link-color, #2481cc);
}
.edit-area textarea:disabled {
    opacity: 0.7;
    cursor: not-allowed;
    background-color: var(--tg-theme-secondary-bg-color, #f5f5f5);
}

.edit-buttons {
    display: flex;
    justify-content: flex-end; /* Buttons on the right */
    gap: 8px;
}

.edit-buttons button {
    display: flex;
    align-items: center;
    justify-content: center; /* Center icon */
    gap: 4px; /* Space between icon and text if any */
    padding: 6px 8px; /* Adjust padding */
    min-width: 32px; /* Ensure minimum width */
    height: 32px; /* Fixed height */
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-size: 0.9em;
    transition: background-color 0.2s ease, opacity 0.2s ease;
}
.edit-buttons button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.edit-save {
    background-color: #4CAF50; /* Green for save */
    color: #fff;
}
.edit-save:hover:not(:disabled) {
    background-color: #45a049;
}
.edit-cancel {
    background-color: var(--tg-theme-secondary-bg-color, #e0e0e0);
    color: var(--tg-theme-text-color, #000);
}
.edit-cancel:hover:not(:disabled) {
    background-color: #d5d5d5;
}
.edit-buttons button svg {
    width: 16px; /* Consistent icon size */
    height: 16px;
}
/* --- END Message Editing Styles --- */


/* Export Info Area Styles */
.export-info { padding: 8px 10px; margin: 0 10px 10px 10px; border-radius: 6px; background-color: rgba(0, 0, 0, 0.03); border: 1px solid var(--tg-theme-hint-color, #e0e0e0); font-size: 0.85em; flex-shrink: 0; }
.export-info .copy-feedback { margin: 0 0 5px 0; font-weight: 500; text-align: center; }
.export-info .copy-feedback.success { color: #4CAF50; }
.export-info .copy-feedback.error { color: var(--tg-theme-destructive-text-color, #e53935); }
.export-link-container { display: flex; align-items: center; justify-content: space-between; gap: 8px; }
.export-link-container a { color: var(--tg-theme-link-color, #2481cc); text-decoration: none; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-grow: 1; }
.export-link-container a:hover { text-decoration: underline; }
.export-info .copy-link-button { background: none; border: none; padding: 0; margin: 0; cursor: pointer; color: var(--tg-theme-link-color, #2481cc); flex-shrink: 0; display: flex; align-items: center; }
.copy-link-button:hover { opacity: 0.8; }

/* Responsive adjustments */
@media (max-width: 767px) {
  .sidebar { position: fixed; top: 0; left: 0; }
  .app-container.sidebar-closed .sidebar { margin-left: -260px; visibility: hidden; }
  .chat-main { width: 100%; }
  .chat-header { padding-left: 55px; }
  .chat-header h1 { font-size: 1em; }
  .model-selector select { font-size: 0.85em; padding: 4px 8px; }
  /* Make edit button slightly easier to tap on mobile */
  .edit-message-button { width: 28px; height: 28px; bottom: -10px; right: -10px; }
  .edit-message-button svg { width: 16px; height: 16px; }
}

/* --- END OF FILE App.css --- */